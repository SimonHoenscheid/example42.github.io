I"<p>In our Puppet operations we may need to apply some resources only in given periods of time, such as maintenance windows, os specific days of the week of hour.</p>

<p>Puppet has a quite useful, and not too much known, resource for that: <code class="highlighter-rouge">schedule</code>.</p>

<p>The schedule resource type can be used to define a time period. Once defined, by using the <code class="highlighter-rouge">schedule</code> metaparamter we can tell to Puppet to apply a given resource only when Puppet is running within the specified schedule.</p>

<p>For example, we can define a daily schedule from 2 AM to 4 AM, and also specify how many times a resource using such schedule should be applied via the <code class="highlighter-rouge">repeat</code> parameter, as follows:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>schedule { 'maintenance':
  range  =&gt; '2 - 4',
  period =&gt; daily,
  repeat =&gt; 1,
}
</code></pre></div></div>

<p>and then apply to to any resource, via the schedule metaparameter:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>exec { '/usr/local/bin/daily_maintenance':
  schedule =&gt; 'maintenance',
}
</code></pre></div></div>

<p>Note that such piece of code doesn’t guarantee that the command is executed every day, and it doesn’t ensure that this happens at a fixed time.</p>

<p>What will happen is that IF Puppet runs on a node, between 2 and 4 AM, THEN the maintenance exec is applied.</p>

<p>As every other resource type, we can declare as many instances of it as we want, they just need to have different titles.</p>

<p>The full list of attributes is:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>schedule { 'title':
  name        =&gt; # (namevar) The name of the schedule. The title is used if not set the name.
  period      =&gt; # The period of repetition for resources on this schedule, valid values:
                 # hourly, daily, weekly, monthly, never.
  periodmatch =&gt; # Whether periods should be matched by:
                 # - 'number' (IE: two times in an hour) or by
                 # - 'distance' (IE: two times which are 60 minutes apart)
  range       =&gt; # The hour (from 0 to 23) range when to apply a schedule.
                 # Midnight might be crossed with something like: 22:00 - 02:00
  repeat      =&gt; # How often a given resource may be applied in the schedule
  weekday     =&gt; # The days of the week in which the schedule occurs
}
</code></pre></div></div>

<p>If we need to always run a specific command we probably better use <code class="highlighter-rouge">cron</code> on any similar system’s scheduler, as in this case we have more control on when and if commands are executed.</p>

<p>There are still use cases for Puppet’s resource type, for example we can use it to:</p>

<ul>
  <li>Manage different contents of configurations according to the hour or period</li>
  <li>Trigger system reboots if conditions apply</li>
  <li>Manage backups or other maintenance operations (given the described limitations)</li>
  <li>Manage resources which take a long time to be applied and don’t need be to continuously enforced</li>
  <li>Do crazy things nobody has conceived before</li>
</ul>

<p>Alessandro Franceschi</p>
:ET